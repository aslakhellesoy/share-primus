<html>
<head>
  <style>
    #pad {
      width: 100%;
      height: 100%;
      font-size: 20px;
    }
  </style>
  <script src="/primus/primus.js"></script>
  <script src="text.js"></script>
  <script src="share.uncompressed.js"></script>
  <script src="share-primus.js"></script>
</head>

<body>
  <textarea id='pad' autofocus>Connecting...</textarea>
  <script>
  var primus = new Primus();

  /*  
  console.log(primus.readyState);
  // Debug all public client events: https://github.com/primus/primus#events
  'reconnecting,reconnect,timeout,open,error,data,end,close,online,offline'.split(',').forEach(function(e) {
  console.log(primus.readyState);
    primus.on(e, function() {console.log('EVENT', e, arguments);});
  });
  */

  primus.on('open', function() {
    var sjs = new window.sharejs.Connection(primus);
    var doc = sjs.get('test-collection', 'test-doc');
    doc.subscribe();

    doc.whenReady(function () {
      if (!doc.type) doc.create('text');
      doc.attachTextarea(document.getElementById('pad'));
    });
  });
  </script>
<body>
</html>

